<cfcomponent output="false" extends="LiquidDecisionBlock" hint="
An if statement
example
{% if true %} YES {% else %} NO {% endif %}

will return:
YES
">
	
	<cfset this._nodelistHolders = CreateObject("java","java.util.ArrayList").Init()>

	<!--- Array holding the block type, block markup (conditions) and block nodelist --->
	<cfset this._blocks = CreateObject("java","java.util.ArrayList").Init()>

	<cffunction name="init">
		<cfargument name="markup" type="string" required="true">
		<cfargument name="tokens" type="array" required="true">
		<cfargument name="file_system" type="any" required="true">
		<cfargument name="nodelist" type="array" required="true">
		<cfset var loc = {}>
		
		<cfset this._nodelist = arguments.nodelist>
		<!--- <cfset this._nodelist = this._nodelistHolders[ArrayLen(this._blocks)]> --->

		<cfset loc.temp = ['if', arguments.markup,  this._nodelist]>
		<cfset arrayAppend(this._blocks, loc.temp)>
		<cfset arrayAppend(this._nodelist, this._blocks[1])>
		<Cfset this._nodelistHolders = this._nodelist>
<cfdump var="#arguments#" label="if arguments">
<cfdump var="#this._blocks#" label="blocks">
<cfdump var="#this._nodelist#" label="init nodelist">
<cfdump var="#this._nodelistHolders#" label="init _nodelistHolders">

		<cfset loc.results = super.init(arguments.markup, arguments.tokens, arguments.file_system)>
		<cfif !StructKeyExists(loc, "results")>
			<cfset loc.results = "">
		</cfif>
		<cfreturn loc.results>

	</cffunction>

	<cffunction name="unknown_tag" hint="Handler for unknown tags, handle else tags">
		<cfargument name="tag" type="string" required="true">
		<cfargument name="params" type="any" required="true">
		<cfargument name="tokens" type="any" required="true">
		<cfset var loc = {}>
<Cfdump var="#arguments#" label="tagif unknow tag">
<Cfdump var="#this._nodelistHolders#" label="tagif unknow tag _nodelistHolders">
<Cfdump var="#this._blocks#" label="tagif unknow tag _blocks">
		<cfif arguments.tag eq 'else' OR arguments.tag eq 'elsif'>
			
			<!--- Update reference to nodelistHolder for this block --->
			<cfset loc.temp = ArrayLen(this._blocks)>
			<cfset this._nodelist = this._nodelistHolders[loc.temp]>
			<cfset this._nodelistHolders[loc.temp] =  CreateObject("java","java.util.ArrayList").Init()>
			
			<cfset loc.temp = [arguments.tag, arguments.params, this._nodelist]>

			<cfset ArrayAppend(this._blocks, loc.temp)>
<Cfdump var="#this._nodelist#" label="tagif unknow _nodelist">
		<cfelse>
			<cfdump var="#arguments#" label="bbbb"><Cfabort>
			<cfset super.unknown_tag(arguments.tag, arguments.params, arguments.tokens)>
		</cfif>
		
	</cffunction>

	<cffunction name="render" hint="Render the tag">
		<cfargument name="context" type="any" required="true">
		<cfset var loc = {}>
<Cfdump var="in redering"><cfabort>
		<cfset arguments.context.push()>

		<cfset loc.result = "">

		<cfloop array="#this._blocks#" index="loc.block">

			<cfif loc.block[1] eq "else">
				<cfset loc.result = this.render_all(loc.block[1], arguments.context)>
				<cfbreak>
			</cfif>

			<cfif loc.block[1] eq 'if' OR loc.block[1] eq 'elsif'>
				<!--- Extract logical operators --->
				<cfset loc.logicalRegex.match(loc.block[2])>

				<cfset loc.logicalOperators = loc.logicalRegex.matches>
				<cfset loc.temp = array_shift(loc.logicalOperators)>
				<cfset loc.logicalOperators = loc.temp.arr>

				<!--- Extract individual conditions --->
				<cfset loc.temp = loc.logicalRegex.split(loc.block[2])>

				<cfset loc.conditions = []>

				<cfloop array="#loc.temp#" index="loc.condition">
					
					<cfif loc.conditionalRegex.match(loc.condition)>
					
						<cfset loc.t = {}>
						
						<cfset loc.t.left = "">
						<cfif ArrayLen(loc.conditionalRegex.matches eq 2)>
							<cfset loc.t.left = loc.conditionalRegex.matches[2]>
						</cfif>

						<cfset loc.t.operator = "">
						<cfif ArrayLen(loc.conditionalRegex.matches eq 3)>
							<cfset loc.t.operator = loc.conditionalRegex.matches[3]>
						</cfif>
						
						<cfset loc.t.right = "">
						<cfif ArrayLen(loc.conditionalRegex.matches eq 4)>
							<cfset loc.t.right = loc.conditionalRegex.matches[4]>
						</cfif>

						<cfset arrayAppend(loc.conditions, loc.t)>

					<cfelse>
						<cfthrow type="LiquidError" message="Syntax Error in tag 'if' - Valid syntax: if [condition]">
					</cfif>
				</cfloop>

				<cfif ArrayLen(loc.logicalOperators)>

					<!--- If statement contains and/or --->
					<cfset loc.display = true>

					<cfloop from="1" to="#ArrayLen(loc.logicalOperators)#" index="loc.i">
						
						<cfset loc.t = loc.conditions[loc.i]>
						<cfset loc.iLeft = this.interpret_condition(loc.t['left'], loc.t['right'], loc.t['operator'], arguments.context)>
						
						<cfset loc.tt = loc.conditions[IncrementValue(loc.i)]>
						<cfset loc.iRight = this.interpret_condition(loc.t['left'], loc.t['right'], loc.t['operator'], arguments.context)>


						<cfif loc.logicalOperators[loc.i] eq 'and'>
							<cfset loc.display = loc.iLeft AND loc.iRight>
						<cfelse>
							<cfset loc.display = loc.iLeft OR loc.iRight>
						</cfif>
					</cfloop>

				<cfelse>
					<!--- If statement is a single condition --->
					<cfset loc.display = this.interpret_condition(loc.conditions[1]['left'], loc.conditions[1]['right'], loc.conditions[1]['operator'], arguments.context)>
				</cfif>

				<cfif loc.display>
					<cfset loc.result = this.render_all(loc.block[3], arguemnts.context)>
					<cfbreak>
				</cfif>
				
			</cfif>
		</cfloop>

		<cfset arguments.context.pop()>

		<cfreturn loc.result>
	</cffunction>
	
</cfcomponent>
